"use strict";(self.webpackChunkelemental_docs=self.webpackChunkelemental_docs||[]).push([[8681],{3905:(e,t,a)=>{a.d(t,{Zo:()=>m,kt:()=>h});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},m=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,m=o(e,["components","mdxType","originalType","parentName"]),c=p(a),d=r,h=c["".concat(s,".").concat(d)]||c[d]||u[d]||l;return a?n.createElement(h,i(i({ref:t},m),{},{components:a})):n.createElement(h,i({ref:t},m))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=a.length,i=new Array(l);i[0]=d;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[c]="string"==typeof e?e:r,i[1]=o;for(var p=2;p<l;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},9026:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>l,metadata:()=>o,toc:()=>p});var n=a(7462),r=(a(7294),a(3905));const l={sidebar_label:"Air-Gapped Installation",title:""},i=void 0,o={unversionedId:"airgap",id:"airgap",title:"",description:"Install Elemental in an Air-Gapped Environment",source:"@site/docs/airgap.md",sourceDirName:".",slug:"/airgap",permalink:"/next/airgap",draft:!1,tags:[],version:"current",frontMatter:{sidebar_label:"Air-Gapped Installation",title:""},sidebar:"docs",previous:{title:"Add a custom certificate",permalink:"/next/custom-certificate"},next:{title:"Rancher upgrades",permalink:"/next/troubleshooting-rancher-upgrades"}},s={},p=[{value:"Install Elemental in an Air-Gapped Environment",id:"install-elemental-in-an-air-gapped-environment",level:2},{value:"Assumptions",id:"assumptions",level:3},{value:"Download Elemental charts and Elemental images",id:"download-elemental-charts-and-elemental-images",level:3},{value:"Perform Elemental installation using the generated artifacts",id:"perform-elemental-installation-using-the-generated-artifacts",level:3},{value:"Elemental UI Extension",id:"elemental-ui-extension",level:3}],m={toc:p},c="wrapper";function u(e){let{components:t,...a}=e;return(0,r.kt)(c,(0,n.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"install-elemental-in-an-air-gapped-environment"},"Install Elemental in an Air-Gapped Environment"),(0,r.kt)("h3",{id:"assumptions"},"Assumptions"),(0,r.kt)("p",null,"A Rancher air-gapped installation should be already configured as per the ",(0,r.kt)("a",{parentName:"p",href:"https://ranchermanager.docs.rancher.com/pages-for-subheaders/air-gapped-helm-cli-install"},"official Rancher documentation"),".\nIn particular, a private registry should be available in the air-gapped infrastructure."),(0,r.kt)("h3",{id:"download-elemental-charts-and-elemental-images"},"Download Elemental charts and Elemental images"),(0,r.kt)("p",null,"In order to run Elemental in an air-gapped environment the following artifacts are needed:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"the Elemental Operator charts"),(0,r.kt)("li",{parentName:"ul"},"the container images referenced in the charts (the ",(0,r.kt)("em",{parentName:"li"},"elemental-operator")," and ",(0,r.kt)("em",{parentName:"li"},"seedimage-builder")," images)"),(0,r.kt)("li",{parentName:"ul"},"the containerized OS images")),(0,r.kt)("p",null,"Moreover, it could be handy to create a ",(0,r.kt)("em",{parentName:"p"},"channel image")," referencing the containerized OS images available.\nThe official channel image (the ",(0,r.kt)("em",{parentName:"p"},"elemental-teal-channel")," one) references absolute URLs of the OS images on the official suse registry, so it cannot be used in an air-gapped scenario."),(0,r.kt)("p",null,"All these steps can be performed by executing the ",(0,r.kt)("a",{parentName:"p",href:"https://raw.githubusercontent.com/rancher/elemental-operator/main/scripts/elemental-airgap.sh"},(0,r.kt)("inlineCode",{parentName:"a"},"elemental-airgap.sh")," script")," from a host with Internet access.\nYou can provide manually downloaded Elemental charts to the script or let it download the helm charts for you.\n",(0,r.kt)("inlineCode",{parentName:"p"},"elemental-airgap.sh")," will inspect the Elemental Operator chart, identify all the required container images, download and save them in an archive.\nIt will also build a new OS channel image with OS URLs pointing to the private registry (which must be specified as an argument on the command line)."),(0,r.kt)("p",null,"Here we will download all the artifacts and build a custom channel from the latest stable release of Elemental:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell",metastring:"showLineNumbers",showLineNumbers:!0},"wget https://raw.githubusercontent.com/rancher/elemental-operator/main/scripts/elemental-airgap.sh\nchmod 755 elemental-airgap.sh\n./elemental-airgap.sh stable -r <REGISTRY.YOURDOMAIN.COM:PORT>\n")),(0,r.kt)("p",null,"once completed (the script may take a while) the following files will be available in the current dir:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"elemental-operator-crds-chart-<",(0,r.kt)("em",{parentName:"li"},"VERSION"),">",".tgz"),(0,r.kt)("li",{parentName:"ul"},"elemental-operator-chart-<",(0,r.kt)("em",{parentName:"li"},"VERSION"),">",".tgz"),(0,r.kt)("li",{parentName:"ul"},"elemental-images.txt"),(0,r.kt)("li",{parentName:"ul"},"elemental-images.tar.gz")),(0,r.kt)("h3",{id:"perform-elemental-installation-using-the-generated-artifacts"},"Perform Elemental installation using the generated artifacts"),(0,r.kt)("p",null,"All the above files should be copied to a host which:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Has access to the private registry. If the private registry requires authentication log into it:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shellnocolor",metastring:"showLineNumbers",showLineNumbers:!0},"docker login <REGISTRY.YOURDOMAIN.COM:PORT>\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Has the kubectl binary installed and configured to access the air-gapped Rancher cluster."),(0,r.kt)("li",{parentName:"ul"},"Has the helm binary installed.")),(0,r.kt)("p",null,"Two steps are needed to perform the Elemental installation:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"load the archive with all the required container images on the private registry:\nthis could be done using the ",(0,r.kt)("inlineCode",{parentName:"li"},"rancher-load-images.sh")," script distributed with the Rancher release and already used for the Rancher air-gapped deployment:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shellnocolor",metastring:"showLineNumbers",showLineNumbers:!0},"rancher-load-images.sh \\\n   --image-list elemental-images.txt \\\n   --images elemental-images.tar.gz \\\n   --registry <REGISTRY.YOURDOMAIN.COM:PORT>\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"install the downloaded elemental charts configuring the local registry and the newly created channel:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shellnocolor",metastring:"showLineNumbers",showLineNumbers:!0},"helm upgrade --create-namespace -n cattle-elemental-system \\\n  --install elemental-operator-crds elemental-operator-crds-chart-<VERSION>.tgz\n\nhelm upgrade --create-namespace -n cattle-elemental-system \\\n  --install elemental-operator elemental-operator-chart-<VERSION>.tgz \\\n  --set registryUrl=<REGISTRY.YOURDOMAIN.COM:PORT> \\\n  --set channel.repository=rancher/elemental-teal-channel-<REGISTRY.YOURDOMAIN.COM>\n")),(0,r.kt)("admonition",{title:"The elemental airgap script outputs the required commands",type:"info"},(0,r.kt)("p",{parentName:"admonition"},"The ",(0,r.kt)("inlineCode",{parentName:"p"},"elemental-airgap.sh")," scripts prints out the required commands shown above but using the actual chart version and the provided registry URL to allow to just copy and paste.")),(0,r.kt)("h3",{id:"elemental-ui-extension"},"Elemental UI Extension"),(0,r.kt)("p",null,"Rancher 2.7.x doesn't support UI extensions plugin in air-gapped environments, and so the Elemental UI is not available in Rancher 2.7.x."),(0,r.kt)("p",null,"The Elemental UI plugin will be present in the available UI extensions in Rancher 2.8.0."))}u.isMDXComponent=!0}}]);