"use strict";(self.webpackChunkelemental_docs=self.webpackChunkelemental_docs||[]).push([[2684],{63772:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>m,frontMatter:()=>i,metadata:()=>h,toc:()=>l});var s=t(17624),o=t(4552),a=t(19668);const i={sidebar_label:"Customize hostname",title:""},r=void 0,h={id:"hostname",title:"",description:"Customize hostname",source:"@site/versioned_docs/version-1.4/hostname.md",sourceDirName:".",slug:"/hostname",permalink:"/hostname",draft:!1,unlisted:!1,tags:[],version:"1.4",frontMatter:{sidebar_label:"Customize hostname",title:""},sidebar:"docs",previous:{title:"Elemental behind proxy",permalink:"/elemental_behind_proxy"},next:{title:"Configure Networking",permalink:"/networking"}},c={},l=[{value:"Customize hostname",id:"customize-hostname",level:2},{value:"Elemental hostname management overview",id:"elemental-hostname-management-overview",level:3},{value:"Default hostname",id:"default-hostname",level:3},{value:"Set a custom hostname",id:"set-a-custom-hostname",level:3},{value:"Keep the hostname assigned from DHCP",id:"keep-the-hostname-assigned-from-dhcp",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",p:"p",strong:"strong",...(0,o.M)(),...e.components},{CodeBlock:t,Head:i}=n;return t||u("CodeBlock",!0),i||u("Head",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i,{children:(0,s.jsx)("link",{rel:"canonical",href:"https://elemental.docs.rancher.com/hostname"})}),"\n",(0,s.jsx)(n.h2,{id:"customize-hostname",children:"Customize hostname"}),"\n",(0,s.jsx)(n.h3,{id:"elemental-hostname-management-overview",children:"Elemental hostname management overview"}),"\n",(0,s.jsxs)(n.p,{children:["When a host boots from the Elemental ISO, the hostname is temporarily set (",(0,s.jsx)(n.em,{children:"transient hostname"}),") to the one provided from the DHCP server.\nIf the DHCP server doesn't provide a hostname, the Elemental ISO provides a transient hostname\nin the form: ",(0,s.jsx)(n.code,{children:"rancher-${RANDOM}"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["As soon as the boot process is finished, the registration phase kicks in: the host connects to\nthe Elemental Operator, which creates a ",(0,s.jsx)(n.code,{children:"MachineInventory"})," for the host.\nEach host registered with the Elemental Operator is tracked by a ",(0,s.jsx)(n.code,{children:"MachineInventory"})," resource."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsxs)(n.strong,{children:["The ",(0,s.jsx)(n.code,{children:"name"})," of the ",(0,s.jsx)(n.code,{children:"MachineInventory"})," resource associated with the node is the permanent (static) hostname"]}),"\n",(0,s.jsx)(n.strong,{children:"eventually set to the host"}),".\nThis permanent hostname ",(0,s.jsx)(n.strong,{children:"is set on the node during the K8s cluster provisioning phase only"}),".\nBefore the K8s provisioning phase, the node hostname is either the DHCP assigned one or ",(0,s.jsx)(n.code,{children:"rancher-${RANDOM}"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["For the remainder of this section we will refer to the ",(0,s.jsx)(n.code,{children:"hostname"})," meaning the ",(0,s.jsx)(n.em,{children:"permanent"})," hostname,\ni.e., the hostname that is set after the host has been provisioned as part of a K8s cluster."]}),"\n",(0,s.jsx)(n.h3,{id:"default-hostname",children:"Default hostname"}),"\n",(0,s.jsxs)(n.p,{children:["The default name assigned to each newly created MachineInventory is in the form ",(0,s.jsx)(n.code,{children:"m-{$UUID}"}),".\nWhen the host is provisioned as part of a Cluster, that ",(0,s.jsx)(n.code,{children:"m-{UUID}"})," name is set as the hostname of\nthe corresponding host, overriding the previous assigned hostname (",(0,s.jsx)(n.code,{children:"rancher-{$RANDOM}"})," or the DHCP assigned one)."]}),"\n",(0,s.jsx)(n.h3,{id:"set-a-custom-hostname",children:"Set a custom hostname"}),"\n",(0,s.jsxs)(n.p,{children:["The hostname can be specified setting the ",(0,s.jsx)(n.a,{href:"/machineregistration-reference#machinename",children:(0,s.jsx)(n.code,{children:"machineName"})})," field in the\n",(0,s.jsx)(n.a,{href:"/machineregistration-reference",children:"'MachineRegistration'"})," resource."]}),"\n",(0,s.jsxs)(n.p,{children:["The hostname set in the ",(0,s.jsx)(n.code,{children:"machineName"})," field is expected to be in a template form, in order to be uniquely generated\nfor each registering node, using ",(0,s.jsx)(n.a,{href:"/smbios",children:"SMBIOS"})," and ",(0,s.jsx)(n.a,{href:"/hardwarelabels",children:"Hardware Labels"})," data."]}),"\n",(0,s.jsxs)(n.admonition,{title:"important note",type:"caution",children:[(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"machineName"})," field in the ",(0,s.jsx)(n.code,{children:"MachineRegistration"})," resource is used as the blueprint not\nonly for the hostname of the registering host, but also for the name of the ",(0,s.jsx)(n.code,{children:"MachineInventory"})," resource\ncreated to track the host."]}),(0,s.jsxs)(n.p,{children:["This means that if you don't use a templated ",(0,s.jsx)(n.code,{children:"machineName"})," such to generate a unique name for each\nhost that will boot using the same ",(0,s.jsx)(n.code,{children:"MachineRegistration"})," data (i.e., the same ISO), only the first\nregistering host will be successful while the others will fail: the ",(0,s.jsx)(n.code,{children:"MachineInventory"})," name must be\nunique."]})]}),"\n","\n","\n",(0,s.jsx)(n.h3,{id:"keep-the-hostname-assigned-from-dhcp",children:"Keep the hostname assigned from DHCP"}),"\n",(0,s.jsxs)(n.p,{children:["In order to keep the hostname assigned from the DHCP server before the host registers to the operator,\nthe ",(0,s.jsx)(n.code,{children:"MachineRegistration"})," ",(0,s.jsx)(n.a,{href:"/machineregistration-reference#machinename",children:(0,s.jsx)(n.code,{children:"machineName field"})})," should be set\nto the ",(0,s.jsx)(n.code,{children:"${System Data/Runtime/Hostname}"})," ",(0,s.jsx)(n.a,{href:"/hardwarelabels",children:"Hardware Label"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["This way Elemental will use the current hostname as the ",(0,s.jsx)(n.code,{children:"MachineInventory"})," name during\nthe registration phase, which will be later set as the static hostname of the host during the\nprovisioning phase."]}),"\n",(0,s.jsx)(t,{language:"yaml",title:"registration example with hostname and MachineInventory name set on the hostname got by the DHCP server",showLineNumbers:!0,children:a.c}),"\n",(0,s.jsxs)(n.admonition,{title:"DHCP hostname breaks reset functionality",type:"caution",children:[(0,s.jsxs)(n.p,{children:["SLE Micro images distributed through the default Elemental channel enforce ",(0,s.jsx)(n.em,{children:"recovery"})," as the static hostname when\na machine is rebooted into recovery mode."]}),(0,s.jsxs)(n.p,{children:["If the ",(0,s.jsx)(n.a,{href:"/reset",children:"reset functionality"})," has been enabled, when a machine is reset, it gets rebooted in\nrecovery mode, so it gets the ",(0,s.jsx)(n.em,{children:"recovery"})," static hostname.\nIt then registers anew to the operator, triggering the creation of a new MachineInventory with name\n",(0,s.jsx)(n.em,{children:"recovery"}),"."]}),(0,s.jsxs)(n.p,{children:["The next machine going through the reset process will end up trying to register with the same\n",(0,s.jsx)(n.em,{children:"recovery"})," name, causing a registration failure due to duplicated name."]})]})]})}function m(e={}){const{wrapper:n}={...(0,o.M)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}function u(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},19668:(e,n,t)=>{t.d(n,{c:()=>s});const s='apiVersion: elemental.cattle.io/v1beta1\nkind: MachineRegistration\nmetadata:\n  name: my-nodes\n  namespace: fleet-default\nspec:\n  machineName: "${System Data/Runtime/Hostname}"\n  config:\n    cloud-config:\n      users:\n        - name: root\n          passwd: root\n    elemental:\n      install:\n        reboot: true\n        device: /dev/sda\n        debug: true\n  machineInventoryLabels:\n    elemental.cattle.io/CpuTotalCores: "${System Data/CPU/Total Cores}"\n    elemental.cattle.io/CpuTotalThreads: "${System Data/CPU/Total Threads}"\n    elemental.cattle.io/TotalMemoryBytes: "${System Data/Memory/Total Physical Bytes}"\n    elemental.cattle.io/NumberBlockDevices: "${System Data/Block Devices/Number Devices}"\n'},4552:(e,n,t)=>{t.d(n,{I:()=>r,M:()=>i});var s=t(11504);const o={},a=s.createContext(o);function i(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);